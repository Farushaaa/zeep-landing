<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Zeep - Referral Invitation</title>

    <!-- iOS Smart App Banner (disabled for now since app isn't published) -->
    <!-- <meta name="apple-itunes-app" content="app-id=YOUR_APP_ID"> -->

    <!-- Social sharing meta tags -->
    <meta property="og:title" content="You've been invited to join Zeep!">
    <meta property="og:description" content="Your friend invited you to join Zeep. Download the app now and start earning rewards!">
    <meta property="og:image" content="https://farushaaa.github.io/zeep-landing/share-image.png">
    <meta property="og:url" content="https://farushaaa.github.io/zeep-landing/">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="You've been invited to join Zeep!">
    <meta name="twitter:description" content="Your friend invited you to join Zeep. Download the app now!">
    <meta name="twitter:image" content="https://farushaaa.github.io/zeep-landing/share-image.png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1F893D 0%, #2DA85A 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            width: 100%;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            margin: 0 auto 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 28px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .status-message {
            margin: 30px 0;
        }

        .loading {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #statusText {
            font-size: 18px;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }

        #noAppMessage {
            margin-top: 30px;
        }

        #noAppMessage h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .app-icons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .app-link {
            display: block;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .app-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .footer {
            margin-top: 40px;
            opacity: 0.7;
            font-size: 14px;
        }

        /* Development mode indicator */
        .dev-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 193, 7, 0.9);
            color: #000;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        .dev-info {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .dev-info h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .dev-info p {
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.9;
        }

        /* Mobile optimizations */
        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }

            h1 {
                font-size: 24px;
            }

            .logo {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }

            .dev-indicator {
                top: 10px;
                right: 10px;
                font-size: 10px;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
<!-- Development mode indicator -->
<div id="devIndicator" class="dev-indicator hidden">
    üöß DEV MODE
</div>

<div class="container">
    <div class="logo">Z</div>

    <h1>You've been invited!</h1>
    <p class="subtitle">
        Your friend invited you to join <strong>Zeep</strong>.
        <br>Get the app and claim your invite!
    </p>

    <!-- Development mode info -->
    <div id="devInfo" class="dev-info hidden">
        <h3>üöß Development Mode</h3>
        <p>This app is in development. You'll need <strong>Expo Go</strong> to test the referral link.</p>
    </div>

    <div class="status-message">
        <div id="loadingSpinner" class="loading"></div>
        <p id="statusText">Checking if you have the Zeep app...</p>
    </div>

    <div id="noAppMessage" class="hidden">
        <h2 id="downloadTitle">Get the Zeep App!</h2>
        <p class="subtitle" id="downloadSubtitle">Download Zeep to accept this invitation and start earning rewards!</p>

        <div class="app-icons">
            <a href="#" id="iosLink" class="app-link">
                üì± Download for iPhone
            </a>
            <a href="#" id="androidLink" class="app-link">
                ü§ñ Download for Android
            </a>
        </div>
    </div>

    <div class="footer">
        <p id="footerText">Free to download ‚Ä¢ Available worldwide</p>
    </div>
</div>

<!-- Load the enhanced script -->
<script>
    // Enhanced referral landing script with Expo Go support
    function getReferralCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('ref');
        console.log('üì± Referral code extracted:', code);
        return code;
    }

    function isIOS() {
        return /iPad|iPhone|iPod/.test(navigator.userAgent);
    }

    function isAndroid() {
        return /Android/.test(navigator.userAgent);
    }

    function isMobile() {
        return isIOS() || isAndroid();
    }

    // üÜï Development mode detection
    function isDevelopmentMode() {
        // You can control this via URL parameter or always true during development
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('dev') !== 'false' && window.location.hostname.includes('github.io');
    }

    function init() {
        console.log('üöÄ Initializing landing page...');
        console.log('üìç Current URL:', window.location.href);
        console.log('üîç User Agent:', navigator.userAgent);
        console.log('üì± Is Mobile:', isMobile());
        console.log('üöß Development Mode:', isDevelopmentMode());

        // Show development mode indicator
        if (isDevelopmentMode()) {
            document.getElementById('devIndicator').classList.remove('hidden');
            document.getElementById('devInfo').classList.remove('hidden');
        }

        const referralCode = getReferralCode();

        if (!referralCode) {
            console.log('‚ùå No referral code found');
            showError('No referral code found');
            return;
        }

        console.log('‚úÖ Referral code found:', referralCode);
        setupStoreLinks(referralCode);

        // Only try app detection on mobile devices
        if (isMobile()) {
            attemptAppOpen(referralCode);
        } else {
            console.log('üíª Desktop detected, showing download options');
            showDownloadOptions();
        }

        trackReferralVisit(referralCode);
    }

    function attemptAppOpen(referralCode) {
        console.log('üì± Attempting to open app...');

        const statusText = document.getElementById('statusText');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Update status based on development mode
        if (isDevelopmentMode()) {
            statusText.textContent = 'Opening Expo Go...';
        } else {
            statusText.textContent = 'Opening Zeep app...';
        }

        const DETECTION_TIMEOUT = 2500; // Slightly longer for Expo Go
        let appOpened = false;
        let timeoutId;

        function onAppOpen() {
            if (!appOpened) {
                console.log('‚úÖ App opened successfully');
                appOpened = true;
                clearTimeout(timeoutId);
                statusText.textContent = isDevelopmentMode() ? 'Opening in Expo Go...' : 'Opening app...';
            }
        }

        // Detection method
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                onAppOpen();
            }
        });

        // Try to open the app
        tryOpenApp(referralCode);

        // Show download options after timeout
        timeoutId = setTimeout(() => {
            if (!appOpened) {
                console.log('‚è∞ App detection timeout - showing download options');
                showDownloadOptions();
            }
        }, DETECTION_TIMEOUT);
    }

    function tryOpenApp(referralCode) {
        console.log('üéØ Trying to open app with code:', referralCode);

        if (isDevelopmentMode()) {
            // üÜï Development mode: Open via Expo Go
            console.log('üöß Development mode - opening via Expo Go');
            tryOpenExpoGo(referralCode);
        } else {
            // Production mode: Use custom scheme
            tryOpenProductionApp(referralCode);
        }
    }

    function tryOpenExpoGo(referralCode) {
        // üö® Replace with your actual Expo username
        const EXPO_USERNAME = 'YOUR_EXPO_USERNAME'; // ‚ö†Ô∏è UPDATE THIS
        const EXPO_PROJECT_SLUG = 'zeep';

        if (isIOS()) {
            console.log('üçé iOS + Expo Go');

            // Method 1: Try Expo Go universal link with deep link
            const expoUniversalLink = `https://expo.dev/--/to-exp/exp://exp.host/@${EXPO_USERNAME}/${EXPO_PROJECT_SLUG}?referralCode=${referralCode}`;

            // Method 2: Direct Expo Go scheme
            const expoSchemeUrl = `exp://exp.host/@${EXPO_USERNAME}/${EXPO_PROJECT_SLUG}?referralCode=${referralCode}`;

            // Try universal link first
            window.location.href = expoUniversalLink;

            // Fallback to scheme after delay
            setTimeout(() => {
                window.location.href = expoSchemeUrl;
            }, 1000);

        } else if (isAndroid()) {
            console.log('ü§ñ Android + Expo Go');

            // For Android, we can try the intent URL for Expo Go
            const expoIntent = `intent://exp.host/@${EXPO_USERNAME}/${EXPO_PROJECT_SLUG}?referralCode=${referralCode}#Intent;scheme=exp;package=host.exp.exponent;end`;

            try {
                window.location.href = expoIntent;
            } catch (e) {
                console.log('‚ö†Ô∏è Expo intent failed, trying scheme');
                window.location.href = `exp://exp.host/@${EXPO_USERNAME}/${EXPO_PROJECT_SLUG}?referralCode=${referralCode}`;
            }
        }
    }

    function tryOpenProductionApp(referralCode) {
        if (isIOS()) {
            console.log('üçé iOS Production - trying custom scheme');
            window.location.href = `zeep://referral/${referralCode}`;
        } else if (isAndroid()) {
            console.log('ü§ñ Android Production - trying intent');
            const intentUrl = `intent://referral/${referralCode}#Intent;scheme=zeep;package=com.diarcode.zeepmobile;end`;

            try {
                window.location.href = intentUrl;
            } catch (e) {
                console.log('‚ö†Ô∏è Intent failed, trying custom scheme');
                window.location.href = `zeep://referral/${referralCode}`;
            }
        }
    }

    function showDownloadOptions() {
        const loadingSpinner = document.getElementById('loadingSpinner');
        const statusText = document.getElementById('statusText');
        const noAppMessage = document.getElementById('noAppMessage');

        if (loadingSpinner) loadingSpinner.style.display = 'none';
        if (statusText) statusText.style.display = 'none';
        if (noAppMessage) noAppMessage.classList.remove('hidden');

        console.log('üì• Showing download options');
    }

    function showError(message) {
        const statusText = document.getElementById('statusText');
        const loadingSpinner = document.getElementById('loadingSpinner');

        if (statusText) statusText.textContent = message;
        if (loadingSpinner) loadingSpinner.style.display = 'none';

        setTimeout(() => {
            // Redirect to your main website or Expo project page
            window.location.href = isDevelopmentMode()
                ? 'https://expo.dev'
                : 'https://zeepapp.com';
        }, 3000);
    }

    function setupStoreLinks(referralCode) {
        const iosLink = document.getElementById('iosLink');
        const androidLink = document.getElementById('androidLink');
        const downloadTitle = document.getElementById('downloadTitle');
        const downloadSubtitle = document.getElementById('downloadSubtitle');
        const footerText = document.getElementById('footerText');

        if (isDevelopmentMode()) {
            // üÜï Development mode: Link to Expo Go
            downloadTitle.textContent = 'Get Expo Go!';
            downloadSubtitle.textContent = 'Download Expo Go to test the Zeep app with this referral code.';
            footerText.textContent = 'Development mode ‚Ä¢ Requires Expo Go';

            if (iosLink) {
                iosLink.href = 'https://apps.apple.com/app/expo-go/id982107779';
                iosLink.textContent = 'üì± Get Expo Go for iPhone';
                console.log('üîó iOS Expo Go link set');
            }

            if (androidLink) {
                androidLink.href = 'https://play.google.com/store/apps/details?id=host.exp.exponent';
                androidLink.textContent = 'ü§ñ Get Expo Go for Android';
                console.log('üîó Android Expo Go link set');
            }
        } else {
            // Production mode: Link to your actual app
            if (iosLink) {
                iosLink.href = `https://apps.apple.com/app/zeep/id123456789?pt=${referralCode}&ct=referral`;
                iosLink.textContent = 'üì± Download for iPhone';
                console.log('üîó iOS App Store link set');
            }

            if (androidLink) {
                androidLink.href = `https://play.google.com/store/apps/details?id=com.diarcode.zeepmobile&referrer=utm_source%3Dreferral%26utm_medium%3Dlink%26utm_campaign%3D${referralCode}`;
                androidLink.textContent = 'ü§ñ Download for Android';
                console.log('üîó Android Play Store link set');
            }
        }
    }

    function trackReferralVisit(referralCode) {
        console.log('üìä Tracking referral visit...');

        const trackingData = {
            referralCode: referralCode,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            source: 'landing_page',
            platform: isIOS() ? 'ios' : isAndroid() ? 'android' : 'web',
            url: window.location.href,
            developmentMode: isDevelopmentMode()
        };

        // üÜï For development, just log to console and localStorage
        if (isDevelopmentMode()) {
            console.log('üìä Development tracking data:', trackingData);
            try {
                localStorage.setItem('zeep_referral_debug', JSON.stringify(trackingData));
            } catch (e) {
                console.log('üìä Could not save to localStorage');
            }
        } else {
            // Production tracking
            const trackingEndpoint = 'https://api.zeepapp.com/track-referral';

            fetch(trackingEndpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(trackingData)
            }).catch((error) => {
                console.log('üìä Tracking failed:', error.message);
            });
        }
    }

    // üÜï Enhanced test buttons for development
    function addTestButtons() {
        if (!isDevelopmentMode()) return;

        setTimeout(() => {
            const container = document.querySelector('.container');
            if (container) {
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                        z-index: 1000;
                    `;

                const buttonStyles = `
                        padding: 8px 12px;
                        background: rgba(31, 137, 61, 0.9);
                        color: white;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        cursor: pointer;
                        backdrop-filter: blur(10px);
                        white-space: nowrap;
                    `;

                // Skip detection button
                const skipButton = document.createElement('button');
                skipButton.textContent = 'üß™ Skip Detection';
                skipButton.style.cssText = buttonStyles;
                skipButton.onclick = () => {
                    console.log('üß™ Manual override triggered');
                    showDownloadOptions();
                };

                // Force Expo Go button
                const expoButton = document.createElement('button');
                expoButton.textContent = 'üöÄ Force Expo Go';
                expoButton.style.cssText = buttonStyles;
                expoButton.onclick = () => {
                    console.log('üöÄ Force Expo Go triggered');
                    const referralCode = getReferralCode();
                    if (referralCode) {
                        tryOpenExpoGo(referralCode);
                    }
                };

                // Debug info button
                const debugButton = document.createElement('button');
                debugButton.textContent = 'üêõ Debug Info';
                debugButton.style.cssText = buttonStyles;
                debugButton.onclick = () => {
                    const debug = localStorage.getItem('zeep_referral_debug');
                    if (debug) {
                        alert('Debug Info:\n\n' + JSON.stringify(JSON.parse(debug), null, 2));
                    } else {
                        alert('No debug info available');
                    }
                };

                buttonContainer.appendChild(skipButton);
                buttonContainer.appendChild(expoButton);
                buttonContainer.appendChild(debugButton);
                document.body.appendChild(buttonContainer);
            }
        }, 3000);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üìÑ DOM loaded, initializing...');
        init();
        addTestButtons();
    });

    // Also run immediately if DOM is already ready
    if (document.readyState !== 'loading') {
        console.log('üìÑ DOM already ready, initializing...');
        init();
        addTestButtons();
    }

    // Add a fallback initialization after 1 second
    setTimeout(() => {
        const statusText = document.getElementById('statusText');
        if (statusText && statusText.textContent.includes('Checking if you have')) {
            console.log('‚ö†Ô∏è Fallback initialization triggered');
            init();
        }
    }, 1000);
</script>
</body>
</html>